var app=angular.module("calc",[]);app.controller("calcController",["$scope",function(e){function t(){e.middle_size=l(e.result).length>16,e.small_size=l(e.result).length>21}function l(e){return e+""}e.type,e.result="0",e.storage=0,e.setType=function(){e.type==calc.SIMPLE?e.type=calc.ADVANCED:(e.type==calc.ADVANCED||void 0==e.type)&&(e.type=calc.SIMPLE),e.keys=calc.setType(e.type)},e.keyClicked=function(c){var a=calc.enterKey(c);e.result=l(a.result),e.storage=a.storage,t()},e.setType()}]);
var storage=0,keyboard={};keyboard.DIGIT1="1",keyboard.DIGIT2="2",keyboard.DIGIT3="3",keyboard.DIGIT4="4",keyboard.DIGIT5="5",keyboard.DIGIT6="6",keyboard.DIGIT7="7",keyboard.DIGIT8="8",keyboard.DIGIT9="9",keyboard.DIGIT0="0",keyboard.OP_DIV="/",keyboard.OP_MUL="*",keyboard.OP_MNS="-",keyboard.OP_PLS="+",keyboard.OP_PNT=".",keyboard.OP_LBR="(",keyboard.OP_RBR=")",keyboard.OP_BCK="←",keyboard.OP_CLR="C",keyboard.OP_EQL="=",keyboard.OP_PST="%",keyboard.OP_SQT="√",keyboard.OP_SQR="x²",keyboard.OP_INV="+-",keyboard.OP_MMS="M-",keyboard.OP_MPL="M+",keyboard.OP_MCL="MC",keyboard.OP_MRD="MR";var model=function(){var e=[{label:keyboard.DIGIT1,type:"digital",value:1},{label:keyboard.DIGIT2,type:"digital",value:2},{label:keyboard.DIGIT3,type:"digital",value:3},{label:keyboard.DIGIT4,type:"digital",value:4},{label:keyboard.DIGIT5,type:"digital",value:5},{label:keyboard.DIGIT6,type:"digital",value:6},{label:keyboard.DIGIT7,type:"digital",value:7},{label:keyboard.DIGIT8,type:"digital",value:8},{label:keyboard.DIGIT9,type:"digital",value:9},{label:keyboard.DIGIT0,type:"digital",value:0},{label:keyboard.OP_PNT,type:"digital",value:"."},{label:keyboard.OP_DIV,type:"operand",operation:"/"},{label:keyboard.OP_MUL,type:"operand",operation:"*"},{label:keyboard.OP_MNS,type:"operand",operation:"-"},{label:keyboard.OP_PLS,type:"operand",operation:"+"},{label:keyboard.OP_LBR,type:"operand",operation:"("},{label:keyboard.OP_RBR,type:"operand",operation:")"},{label:keyboard.OP_BCK,type:"selective",operation:"back"},{label:keyboard.OP_CLR,type:"selective",operation:"clear"},{label:keyboard.OP_EQL,type:"selective",operation:"equal"},{label:keyboard.OP_PST,type:"modifiers",operation:function(e){return e/100}},{label:keyboard.OP_SQT,type:"modifiers",operation:function(e){return Math.sqrt(e)}},{label:keyboard.OP_SQR,type:"modifiers",operation:function(e){return Math.pow(e,2)}},{label:keyboard.OP_INV,type:"modifiers",operation:function(e){if(""==e)throw new Error("empty");return-1*parseFloat(e)+""}},{label:keyboard.OP_MMS,type:"memory",operation:function(e){return void 0!=storage?storage-=parseFloat(e):storage=-1*parseFloat(e),storage}},{label:keyboard.OP_MPL,type:"memory",operation:function(e){return void 0!=storage?storage+=parseFloat(e):storage=parseFloat(e),storage}},{label:keyboard.OP_MCL,type:"memory",operation:function(){return storage=0}},{label:keyboard.OP_MRD,type:"memory",operation:function(){return storage}}];return{getKey:function(r){for(var a in e)if(e[a].label==r.toString())return e[a];return null},getKeys:function(e){var r=[];for(var a in e){var o=this.getKey(e[a]);o&&r.push(o)}return r}}}(),calc=function(){function enterKey(e){switch("digital"!=e.type&&reset(),e.type){case"digital":var r=e.value;if(expression.toString().length>15)break;if(result.toString().length>30)break;1==clearValue?(clearValue=!1,result=r+"",expression=r+""):(expression+=r+"",result+=r+""),result=clear_first_zero(result),result=result.replace(new RegExp(expression+"$","ig"),pointTest(expression)),expression=pointTest(expression);break;case"operand":result=simpleOperator(result,e.operation),expression="",reset();break;case"selective":"back"==e.operation?(result=(result+"").slice(0,(result+"").length-1),expression=""):"clear"==e.operation?(result=clear(result),expression=""):"equal"==e.operation&&(result=compute(result));break;case"modifiers":try{var a=new RegExp(expression+"$");expression=e.operation(expression),result=(""+result).replace(a,expression)}catch(o){result=error,clearValue=!0}break;case"memory":e.label==keyboard.OP_MCL?e.operation():e.label==keyboard.OP_MRD?result+=e.operation():(compute(),result!==error&&e.operation(result))}return result}function reset(){1==clearValue&&(clearValue=!1,result==error&&(result="",expression=""))}function close_brackets(e){for(e+="";e.split("(").length>e.split(")").length;)e=e.concat(")");for(;e.split("(").length<e.split(")").length;)e="(".concat(e);var r=/\d\(/
g;return e=e.replace(r,function(e){return e.replace("(","*(")})}function clear_first_zero(e){return e.length<=1?e:(e+"").replace(/^0+/,"")}function reduce(e){return e.toString().length>10?e.toExponential(9):e}function simpleOperator(e,r){return e+="",(e.search(/([-,+,*,\/])$/)>0?e.slice(0,-1):e)+r}function pointTest(e){return e.replace(/^([^\.]*\.)|\./g,"$1")}function clear(e){return e=0,clearValue=!0,e}function compute(result){var res=result;try{res=close_brackets(res),res=eval(res),result=reduce(res),expression=result}catch(e){result=error}return clearValue=!0,result}var error="Error",calc_type="simple",result="0",expression="0",clearValue=!0;return{SIMPLE:"simple",ADVANCED:"advanced",setType:function(e){var r;return calc_type=e,r=model.getKeys("simple"==calc_type?[keyboard.DIGIT1,keyboard.DIGIT2,keyboard.DIGIT3,keyboard.OP_BCK,keyboard.OP_CLR,keyboard.DIGIT4,keyboard.DIGIT5,keyboard.DIGIT6,keyboard.OP_MNS,keyboard.OP_PLS,keyboard.DIGIT7,keyboard.DIGIT8,keyboard.DIGIT9,keyboard.OP_DIV,keyboard.OP_MUL,keyboard.DIGIT0,keyboard.OP_INV,keyboard.OP_PNT,keyboard.OP_EQL]:[keyboard.OP_MPL,keyboard.OP_MMS,keyboard.OP_MCL,keyboard.OP_MRD,keyboard.OP_CLR,keyboard.OP_SQR,keyboard.OP_SQT,keyboard.OP_PST,keyboard.OP_BCK,keyboard.DIGIT1,keyboard.DIGIT2,keyboard.DIGIT3,keyboard.OP_LBR,keyboard.OP_RBR,keyboard.DIGIT4,keyboard.DIGIT5,keyboard.DIGIT6,keyboard.OP_MNS,keyboard.OP_PLS,keyboard.DIGIT7,keyboard.DIGIT8,keyboard.DIGIT9,keyboard.OP_DIV,keyboard.OP_MUL,keyboard.OP_PNT,keyboard.DIGIT0,keyboard.OP_INV,keyboard.OP_EQL])},enterKey:function(e){return{result:enterKey(e),storage:storage}}}}();